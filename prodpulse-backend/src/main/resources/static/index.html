<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProdPulse.AI - Production System Doctor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: ['class', '[data-theme="dark"]'],
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-main-dark: #050505;
            --bg-main-light: #f8f9fa;
            --bg-card-dark: rgba(17, 17, 17, 0.85);
            --bg-card-light: rgba(255, 255, 255, 0.95);
            --text-primary-dark: #f5f5f5;
            --text-primary-light: #1a1a1a;
            --text-secondary-dark: #a3a3a3;
            --text-secondary-light: #6b7280;
            --text-muted-dark: #71717a;
            --text-muted-light: #9ca3af;
            --border-dark: rgba(255, 255, 255, 0.12);
            --border-light: rgba(0, 0, 0, 0.08);
            --accent-dark: #f5f5f5;
            --accent-light: #111111;
            --shadow-dark: rgba(0, 0, 0, 0.45);
            --shadow-light: rgba(0, 0, 0, 0.12);
            --glass-dark: rgba(15, 15, 15, 0.85);
            --glass-light: rgba(245, 245, 245, 0.95);
        }

        [data-theme="dark"] {
            --bg-main: var(--bg-main-dark);
            --bg-card: var(--bg-card-dark);
            --text-primary: var(--text-primary-dark);
            --text-secondary: var(--text-secondary-dark);
            --text-muted: var(--text-muted-dark);
            --border: var(--border-dark);
            --accent: var(--accent-dark);
            --shadow: var(--shadow-dark);
            --glass: var(--glass-dark);
        }

        [data-theme="light"] {
            --bg-main: var(--bg-main-light);
            --bg-card: var(--bg-card-light);
            --text-primary: var(--text-primary-light);
            --text-secondary: var(--text-secondary-light);
            --text-muted: var(--text-muted-light);
            --border: var(--border-light);
            --accent: var(--accent-light);
            --shadow: var(--shadow-light);
            --glass: var(--glass-light);
        }

        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            position: relative;
            background: var(--bg-main);
            color: var(--text-primary);
            transition: background 0.4s ease, color 0.4s ease;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .content {
            position: relative;
            z-index: 1;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.04);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.4);
        }

        .glass {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .glass-card {
            background: var(--bg-card);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .soft-shadow {
            box-shadow: 0 20px 45px var(--shadow);
        }

        @keyframes pulse-ring {
            0%, 100% {
                transform: scale(0.95);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.3;
            }
        }

        .pulse-ring {
            animation: pulse-ring 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .float {
            animation: float 4s ease-in-out infinite;
        }

        .gradient-text {
            background: linear-gradient(135deg, var(--accent) 0%, #cccccc 50%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }
        .animate-fade-in-down { animation: fadeInDown 0.6s ease-out forwards; }
        .animate-fade-in { animation: fadeIn 0.6s ease-out forwards; }

        .delay-100 { animation-delay: 0.05s; opacity: 0; }
        .delay-200 { animation-delay: 0.1s; opacity: 0; }
        .delay-300 { animation-delay: 0.15s; opacity: 0; }
        .delay-400 { animation-delay: 0.2s; opacity: 0; }
        .delay-500 { animation-delay: 0.25s; opacity: 0; }

        @keyframes typing {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        .typing-dot {
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        .btn-hover {
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }

        .btn-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 40px var(--shadow);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top-color: currentColor;
            animation: spin 0.8s linear infinite;
        }

        .theme-toggle {
            border-radius: 9999px;
            padding: 0.4rem 0.75rem;
            border: 1px solid var(--border);
            background: var(--glass);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.25s ease;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .theme-toggle:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px var(--shadow);
        }

        .theme-icon {
            width: 14px;
            height: 14px;
        }

        .text-primary { color: var(--text-primary); }
        .text-secondary { color: var(--text-secondary); }
        .text-muted { color: var(--text-muted); }
        .bg-glass { background: var(--glass); }
        .border-theme { border-color: var(--border); }

        .debug-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            max-width: 400px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            font-size: 12px;
            font-family: monospace;
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
        }

        .debug-panel .log-entry {
            margin-bottom: 8px;
            padding: 8px;
            background: var(--glass);
            border-radius: 6px;
            border-left: 3px solid;
        }

        .debug-panel .log-entry.info { border-left-color: #3b82f6; }
        .debug-panel .log-entry.success { border-left-color: #10b981; }
        .debug-panel .log-entry.error { border-left-color: #ef4444; }
        .debug-panel .log-entry.warning { border-left-color: #f59e0b; }
    </style>
</head>
<body>
<div id="canvas-container"></div>

<!-- Debug Panel -->
<div id="debugPanel" class="debug-panel hidden">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <span style="font-weight: bold; color: var(--text-primary);">Debug Console</span>
        <button id="closeDebug" style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 16px;">‚úï</button>
    </div>
    <div id="debugLogs"></div>
</div>

<div class="content min-h-screen">
    <header class="animate-fade-in-down">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-6 pb-6">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full border border-theme bg-glass flex items-center justify-center soft-shadow">
                        <span class="text-xs tracking-[0.2em] uppercase font-semibold">PP</span>
                    </div>
                    <span class="text-xs text-secondary tracking-[0.25em] uppercase font-medium">ProdPulse.AI</span>
                </div>

                <div style="display: flex; gap: 12px;">
                    <button id="toggleDebug" class="theme-toggle">
                        <span>üêõ Debug</span>
                    </button>
                    <button id="themeToggle" class="theme-toggle">
                        <svg id="sunIcon" class="theme-icon hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                            <circle cx="12" cy="12" r="4"></circle>
                            <path stroke-linecap="round" d="M12 2v2m0 18v-2m10-8h-2m-18 0H2m18-10l-2 2m0 18l-2 2m-18-10h2m18 0h-2M6 5l2 2m0 18l2 2M6 19l2-2m10 2l2-2m0-18l-2-2"></path>
                        </svg>
                        <svg id="moonIcon" class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 0111.21 3 7 7 0 0012 17a7 7 0 009-4.21z"></path>
                        </svg>
                        <span id="themeLabel">Night</span>
                    </button>
                </div>
            </div>

            <div class="text-center">
                <div class="flex justify-center mb-4 float">
                    <div class="relative">
                        <div class="absolute inset-0 bg-accent opacity-15 rounded-full pulse-ring"></div>
                        <div class="relative w-16 h-16 bg-glass rounded-full flex items-center justify-center soft-shadow border border-theme">
                            <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold mb-3 gradient-text">
                    ProdPulse.AI
                </h1>
                <p class="text-lg md:text-xl text-secondary font-light mb-2">
                    Your Production System Doctor
                </p>
                <p class="text-sm md:text-base text-muted max-w-xl mx-auto leading-relaxed">
                    AI-powered log analysis that diagnoses crashes before they escalate.
                </p>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
        <div class="grid lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-3xl p-6 lg:p-8 animate-fade-in-up delay-100 soft-shadow hover:border-accent/50 transition-all duration-200">
                <div class="flex items-center justify-between mb-5">
                    <h2 class="text-xl font-semibold flex items-center gap-2.5">
                        <div class="w-2.5 h-2.5 bg-accent rounded-full animate-pulse"></div>
                        Input Logs
                    </h2>
                    <div class="flex items-center gap-2 text-xs text-secondary">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Max 150 words
                    </div>
                </div>

                <div class="relative mb-4">
                    <textarea id="logInput"
                              class="w-full h-72 lg:h-80 bg-glass border border-theme rounded-2xl p-5 text-sm resize-none focus:outline-none focus:border-accent/70 focus:ring-2 focus:ring-accent/30 transition-all duration-200 font-mono text-primary placeholder:text-muted"
                              placeholder="Paste your production error logs here...

Example:
Error: connect ECONNREFUSED 127.0.0.1:5432
at TCPConnectWrap.afterConnect
PostgreSQL connection failed
Database not responding on localhost..."></textarea>

                    <div id="wordCounter"
                         class="absolute bottom-4 right-5 px-3.5 py-2 bg-glass backdrop-blur-sm rounded-xl text-xs font-mono font-medium text-secondary border border-theme">
                        0 / 150 words
                    </div>
                </div>

                <button id="analyzeBtn"
                        class="btn-hover w-full bg-accent text-primary font-semibold py-4 px-6 rounded-2xl text-base relative flex items-center justify-center gap-2.5 shadow-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    Analyze Logs
                </button>

                <div id="rateLimitInfo"
                     class="mt-4 p-3 bg-accent/10 border border-accent/30 rounded-xl text-xs text-accent hidden">
                    <span id="remainingRequests">--</span> analyses remaining today
                </div>

                <div class="mt-6 p-4 bg-glass border border-theme rounded-xl">
                    <p class="text-xs text-secondary font-medium mb-2">üí° Pro Tips:</p>
                    <ul class="text-[11px] text-muted space-y-1.5 list-disc list-inside">
                        <li>Look for keywords: "Error", "Exception", "Failed", "FATAL"</li>
                        <li>Include stack traces if available</li>
                        <li>Add environment details (Railway, Docker, etc.)</li>
                    </ul>
                </div>
            </div>

            <div class="glass-card rounded-3xl p-6 lg:p-8 animate-fade-in-up delay-200 soft-shadow hover:border-accent/50 transition-all duration-200">
                <div class="flex items-center justify-between mb-5">
                    <h2 class="text-xl font-semibold flex items-center gap-2.5">
                        <div class="w-2.5 h-2.5 bg-accent rounded-full animate-pulse"></div>
                        Diagnosis
                    </h2>
                </div>

                <div id="outputBox" class="h-72 lg:h-80 bg-glass border border-theme rounded-2xl p-5 overflow-y-auto">
                    <div id="placeholder" class="h-full flex flex-col items-center justify-center text-center">
                        <div class="w-14 h-14 bg-glass rounded-full flex items-center justify-center mb-4 border border-theme">
                            <svg class="w-7 h-7 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <p class="text-secondary text-sm mb-2">Waiting for logs...</p>
                        <p class="text-muted text-xs max-w-xs leading-relaxed">Paste your error logs and click "Analyze Logs" to get instant diagnosis</p>
                    </div>

                    <div id="diagnosisContent" class="hidden space-y-4"></div>
                </div>

                <div class="mt-6 flex gap-3">
                    <button id="copyBtn"
                            class="hidden flex-1 bg-glass hover:bg-accent/20 text-secondary font-medium py-3 px-5 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 border border-theme">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        Copy
                    </button>
                    <button id="clearBtn"
                            class="hidden flex-1 bg-glass hover:bg-accent/10 text-secondary font-medium py-3 px-5 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 border border-theme">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                        Clear
                    </button>
                </div>
            </div>
        </div>

        <div class="grid md:grid-cols-3 gap-5 mt-12 animate-fade-in-up delay-300">
            <div class="glass-card rounded-2xl p-6 text-center hover:scale-[1.02] transition-transform duration-200 soft-shadow">
                <div class="text-3xl font-bold gradient-text mb-2">AI-Powered</div>
                <div class="text-sm text-secondary">Smart Diagnosis</div>
            </div>
            <div class="glass-card rounded-2xl p-6 text-center hover:scale-[1.02] transition-transform duration-200 soft-shadow">
                <div class="text-3xl font-bold gradient-text mb-2">100%</div>
                <div class="text-sm text-secondary">Free for Devs</div>
            </div>
            <div class="glass-card rounded-2xl p-6 text-center hover:scale-[1.02] transition-transform duration-200 soft-shadow">
                <div class="text-3xl font-bold gradient-text mb-2">‚ö°</div>
                <div class="text-sm text-secondary">Instant Results</div>
            </div>
        </div>
    </main>

    <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 mt-20 animate-fade-in delay-500">
        <div class="text-center text-muted text-sm">
            <p class="mb-2">Built for developers who've suffered through "it works on my machine"</p>
            <p class="text-xs text-secondary">Made by a dev who faced 35 prod crashes and said "never again"</p>
        </div>
    </footer>
</div>

<script>
    // ========================================
    // DEBUG LOGGER
    // ========================================
    const debugLogger = {
        logs: [],
        maxLogs: 50,

        log(type, message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            this.logs.push({ type, message, data, timestamp });

            if (this.logs.length > this.maxLogs) {
                this.logs.shift();
            }

            this.render();

            // Also console log for browser devtools
            console[type === 'error' ? 'error' : 'log'](`[${timestamp}] ${message}`, data || '');
        },

        render() {
            const debugLogs = document.getElementById('debugLogs');
            if (!debugLogs) return;

            debugLogs.innerHTML = this.logs.map(log => `
                <div class="log-entry ${log.type}">
                    <div style="color: var(--text-muted); font-size: 10px; margin-bottom: 4px;">
                        ${log.timestamp}
                    </div>
                    <div style="color: var(--text-primary);">
                        ${log.message}
                    </div>
                    ${log.data ? `<pre style="margin-top: 4px; color: var(--text-secondary); font-size: 10px; overflow-x: auto;">${JSON.stringify(log.data, null, 2)}</pre>` : ''}
                </div>
            `).reverse().join('');
        },

        clear() {
            this.logs = [];
            this.render();
        }
    };

    // ========================================
    // CONFIGURATION
    // ========================================
    const API_URL = 'https://prodpulse-ai-1.onrender.com/api';
    debugLogger.log('info', 'Application initialized', { API_URL });

    // ========================================
    // DEBUG PANEL TOGGLE
    // ========================================
    document.getElementById('toggleDebug').addEventListener('click', () => {
        const panel = document.getElementById('debugPanel');
        panel.classList.toggle('hidden');
    });

    document.getElementById('closeDebug').addEventListener('click', () => {
        document.getElementById('debugPanel').classList.add('hidden');
    });

    // ========================================
    // THEME SYSTEM
    // ========================================
    const htmlEl = document.documentElement;
    const themeToggle = document.getElementById('themeToggle');
    const sunIcon = document.getElementById('sunIcon');
    const moonIcon = document.getElementById('moonIcon');
    const themeLabel = document.getElementById('themeLabel');

    function applyTheme(theme) {
        htmlEl.setAttribute('data-theme', theme);
        localStorage.setItem('prodpulse-theme', theme);

        if (theme === 'light') {
            sunIcon.classList.remove('hidden');
            moonIcon.classList.add('hidden');
            themeLabel.textContent = 'Day';
        } else {
            sunIcon.classList.add('hidden');
            moonIcon.classList.remove('hidden');
            themeLabel.textContent = 'Night';
        }
    }

    const savedTheme = localStorage.getItem('prodpulse-theme');
    if (savedTheme) {
        applyTheme(savedTheme);
    } else {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        applyTheme(prefersDark ? 'dark' : 'light');
    }

    themeToggle.addEventListener('click', () => {
        const current = htmlEl.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
        const next = current === 'dark' ? 'light' : 'dark';
        applyTheme(next);
    });

    // ========================================
    // THREE.JS
    // ========================================
    let scene, camera, renderer, particles;

    function initThreeJS() {
        const container = document.getElementById('canvas-container');
        const isMobile = window.innerWidth < 768;

        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 500);
        camera.position.z = 80;

        renderer = new THREE.WebGLRenderer({
            alpha: true,
            antialias: false,
            powerPreference: 'high-performance'
        });

        renderer.setSize(window.innerWidth, window.innerHeight, false);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, isMobile ? 1.2 : 1.5));
        container.appendChild(renderer.domElement);

        const particleCount = isMobile ? 250 : 600;
        const geometry = new THREE.BufferGeometry();
        const positions = new Float32Array(particleCount * 3);
        const colors = new Float32Array(particleCount * 3);

        for (let i = 0; i < particleCount; i++) {
            const i3 = i * 3;
            positions[i3] = (Math.random() - 0.5) * 180;
            positions[i3 + 1] = (Math.random() - 0.5) * 180;
            positions[i3 + 2] = (Math.random() - 0.5) * 180;

            const brightness = Math.random() * 0.6 + 0.4;
            colors[i3] = brightness;
            colors[i3 + 1] = brightness * 0.95;
            colors[i3 + 2] = brightness * 1.05;
        }

        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

        const material = new THREE.PointsMaterial({
            size: isMobile ? 1.2 : 1.8,
            vertexColors: true,
            transparent: true,
            opacity: 0.4
        });

        particles = new THREE.Points(geometry, material);
        scene.add(particles);

        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        if (particles) {
            particles.rotation.x += 0.00015;
            particles.rotation.y += 0.0002;
        }
        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        if (camera && renderer) {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight, false);
        }
    });

    initThreeJS();

    // ========================================
    // DOM ELEMENTS
    // ========================================
    const logInput = document.getElementById('logInput');
    const wordCounter = document.getElementById('wordCounter');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const outputBox = document.getElementById('outputBox');
    const placeholder = document.getElementById('placeholder');
    const diagnosisContent = document.getElementById('diagnosisContent');
    const copyBtn = document.getElementById('copyBtn');
    const clearBtn = document.getElementById('clearBtn');
    const rateLimitInfo = document.getElementById('rateLimitInfo');
    const remainingRequests = document.getElementById('remainingRequests');

    // ========================================
    // WORD COUNTER
    // ========================================
    logInput.addEventListener('input', function() {
        const text = this.value.trim();
        const words = text ? text.split(/\s+/).length : 0;
        wordCounter.textContent = `${words} / 150 words`;

        const counterEl = wordCounter;
        counterEl.className = 'absolute bottom-4 right-5 px-3.5 py-2 bg-glass backdrop-blur-sm rounded-xl text-xs font-mono font-medium border border-theme';

        if (words > 150) {
            counterEl.classList.add('text-red-400', 'border-red-400/50', 'bg-red-500/10');
        } else if (words > 120) {
            counterEl.classList.add('text-yellow-400', 'border-yellow-400/50', 'bg-yellow-500/10');
        }
    });

    // ========================================
    // RATE LIMIT
    // ========================================
    async function fetchRateLimitStatus() {
        try {
            debugLogger.log('info', 'Fetching rate limit status...');
            const url = `${API_URL}/rate-limit-status`;
            debugLogger.log('info', 'Rate limit URL', { url });

            const response = await fetch(url);
            debugLogger.log('success', 'Rate limit response received', {
                status: response.status,
                ok: response.ok
            });

            if (response.ok) {
                const data = await response.json();
                debugLogger.log('success', 'Rate limit data', data);
                remainingRequests.textContent = data.remainingRequests;
                rateLimitInfo.classList.remove('hidden');
            } else {
                debugLogger.log('warning', 'Rate limit check failed', {
                    status: response.status,
                    statusText: response.statusText
                });
            }
        } catch (error) {
            debugLogger.log('error', 'Rate limit check error', {
                message: error.message,
                stack: error.stack
            });
        }
    }

    fetchRateLimitStatus();

    // ========================================
    // ANALYZE LOGS
    // ========================================
    analyzeBtn.addEventListener('click', async function() {
        const text = logInput.value.trim();
        const wordCount = text ? text.split(/\s+/).length : 0;

        debugLogger.log('info', 'Analyze button clicked', { wordCount });

        if (!text) {
            showDiagnosis('warning', '‚ö†Ô∏è No Input', 'Please paste your production logs first.');
            debugLogger.log('warning', 'No input provided');
            return;
        }

        if (wordCount > 150) {
            showDiagnosis('error', 'üö´ Word Limit Exceeded',
                `Your log paste is <strong>${wordCount}</strong> words. Please keep it under 150 words.<br><br>` +
                '<small>üí° Tip: Extract just the error section - look for keywords like "Error", "Exception", "Failed", or "FATAL".</small>'
            );
            debugLogger.log('warning', 'Word limit exceeded', { wordCount });
            return;
        }

        const originalHTML = analyzeBtn.innerHTML;
        analyzeBtn.innerHTML = '<div class="loading mr-2"></div>Analyzing...';
        analyzeBtn.disabled = true;

        try {
            const url = `${API_URL}/analyze`;
            const payload = { logs: text };

            debugLogger.log('info', 'Sending analyze request', {
                url,
                method: 'POST',
                payloadSize: JSON.stringify(payload).length
            });

            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            });

            debugLogger.log('info', 'Analyze response received', {
                status: response.status,
                ok: response.ok,
                statusText: response.statusText,
                headers: Object.fromEntries(response.headers.entries())
            });

            if (!response.ok) {
                let errorData;
                try {
                    errorData = await response.json();
                    debugLogger.log('error', 'API error response', errorData);
                } catch (e) {
                    const textError = await response.text();
                    debugLogger.log('error', 'API error (non-JSON)', {
                        status: response.status,
                        text: textError
                    });
                    errorData = { message: `HTTP ${response.status}: ${textError}` };
                }
                throw new Error(errorData.message || `HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            debugLogger.log('success', 'Analysis completed', data);

            showDiagnosis(data.severity, data.title, data.content);

            fetchRateLimitStatus();
            copyBtn.classList.remove('hidden');
            clearBtn.classList.remove('hidden');

        } catch (error) {
            debugLogger.log('error', 'Analysis failed', {
                message: error.message,
                stack: error.stack
            });

            const msg = error.message.includes('Rate limit')
                ? `Rate limit exceeded. Please try again later.`
                : `Analysis failed: ${error.message}`;
            showDiagnosis('error', '‚ùå Failed', msg);
        } finally {
            analyzeBtn.innerHTML = originalHTML;
            analyzeBtn.disabled = false;
        }
    });

    // ========================================
    // DIAGNOSIS DISPLAY
    // ========================================
    function showDiagnosis(severity, title, content) {
        placeholder.classList.add('hidden');
        diagnosisContent.classList.remove('hidden');

        const badgeConfig = {
            critical: { bg: 'bg-red-500/20', text: 'text-red-300', border: 'border-red-400/60', icon: '‚óè' },
            warning: { bg: 'bg-yellow-500/20', text: 'text-yellow-300', border: 'border-yellow-400/60', icon: '‚óè' },
            error: { bg: 'bg-red-500/20', text: 'text-red-300', border: 'border-red-400/60', icon: '‚óè' },
            default: { bg: 'bg-accent/20', text: 'text-accent', border: 'border-accent/40', icon: '‚óã' }
        };

        const config = badgeConfig[severity] || badgeConfig.default;

        diagnosisContent.innerHTML = `
            <div class="flex items-center gap-3 pb-4 border-b border-theme">
                <span class="px-3 py-1.5 rounded-full text-xs font-semibold ${config.bg} ${config.text} ${config.border} border">
                    ${config.icon} ${title}
                </span>
            </div>
            <div class="text-secondary leading-relaxed diagnosis-html">${content}</div>
        `;
        outputBox.scrollTop = 0;
    }

    // ========================================
    // ACTION BUTTONS
    // ========================================
    copyBtn.addEventListener('click', async () => {
        const text = diagnosisContent.innerText;
        try {
            await navigator.clipboard.writeText(text);
            const original = copyBtn.innerHTML;
            copyBtn.innerHTML = '<svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>Copied!';
            copyBtn.classList.add('bg-accent/30', 'text-accent');
            setTimeout(() => {
                copyBtn.innerHTML = original;
                copyBtn.classList.remove('bg-accent/30', 'text-accent');
            }, 2000);
        } catch (err) {
            console.error('Copy failed', err);
        }
    });

    clearBtn.addEventListener('click', () => {
        logInput.value = '';
        wordCounter.textContent = '0 / 150 words';
        wordCounter.className = 'absolute bottom-4 right-5 px-3.5 py-2 bg-glass backdrop-blur-sm rounded-xl text-xs font-mono font-medium text-secondary border border-theme';

        diagnosisContent.classList.add('hidden');
        placeholder.classList.remove('hidden');
        copyBtn.classList.add('hidden');
        clearBtn.classList.add('hidden');
    });

    logInput.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            analyzeBtn.click();
        }
    });
</script>
</body>
</html>